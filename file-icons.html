<!--
RetroWeb Browser
Copyright (C) 2014 Marcio Teixeira

This program is free software; you can redistribute it and/or
modify it under the terms of the GNU General Public License
as published by the Free Software Foundation; either version 2
of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
-->
<template id="FileIconsTemplate">
	<content></content>
</template>

<style>
	/* It would be better to put these styles inside the template and replace "file-icons" with "::content",
	 * but that only works in Chrome and not Firefox */
	 
	file-icons {
		width:intrinsic; For Safari, see https://developer.mozilla.org/en-US/docs/CSS/width
		width:-moz-fit-content;
		width:-webkit-fit-content;
		width:fit-content;
		
		margin: 0px auto;
	}

	file-icons OL, UL {
		padding: 0px;
		margin: 0px;
		overflow: auto;
		
		/* Disallow selection: */
		
		-webkit-touch-callout: none;
		-webkit-user-select: none;
		-khtml-user-select: none;
		-moz-user-select: none;
		-ms-user-select: none;
		user-select: none;
	}

	file-icons A {
		text-decoration: none;
		color: black;
	}

	file-icons LI {
		float: left;
		margin-right: 20px; /* Spacing between icons */
		margin-bottom: 10px; /* Spacing between icons */
		text-align: center;
		font-size: 15px;
		font-family: Tahoma, Geneva, sans-serif;
		list-style-type: none;
		
		/* Add ellipses to oversized icon labels */
		max-width: 200px;
		white-space: nowrap;
		overflow: hidden;
		text-overflow: ellipsis;
	}

	file-icons LI:last-child {
		margin-right: 0px; /* Spacing between icons */
		margin-bottom: 0px; /* Spacing between icons */
	}

	file-icons A:before {
		content: '';
		margin-left:auto;
		margin-right:auto;
		width:  60px;
		height: 60px;
		display: block;
		pointer-events:none;
		
		background: url('/ui-artwork/floppy.png');
		background-size: 60px 60px;
	}

	file-icons A.boot-floppy:before {
		background: url('/ui-artwork/floppy-dot.png');
		background-size: 60px 60px;
	}

	file-icons A.boot-hd:before {
		background: url('/ui-artwork/hd-dot.png');
		background-size: 60px 60px;
	}

	file-icons A.boot-rom:before {
		background: url('/ui-artwork/rom-dot.png');
		background-size: 60px 60px;
	}

	file-icons A.doc:before {
		background: url('/ui-artwork/document.png');
		background-size: 60px 60px;
	}

	file-icons A.floppy:before {
		background: url('/ui-artwork/floppy.png');
		background-size: 60px 60px;
	}

	file-icons A.folder:before {
		background: url('/ui-artwork/folder.png');
		background-size: 60px 60px;
	}

	file-icons A.folder-dot:before {
		background: url('/ui-artwork/folder-dot.png');
		background-size: 60px 60px;
	}

	file-icons A.hyperlink:before {
		background: url('/ui-artwork/html-doc.png');
		background-size: 60px 60px;
	}

	file-icons A.rom:before {
		background: url('/ui-artwork/rom.png');
		background-size: 60px 60px;
	}

	file-icons A.upload-floppy:before,
	file-icons A.download-floppy:before,
	file-icons A.download-file:before,
	file-icons A.upload-file:before {
		background: url('/ui-artwork/upload.png');
		background-size: 60px 60px;
	}

	file-icons A.enter-url:before {
		background: url('/ui-artwork/world.png');
		background-size: 60px 60px;
	}

	file-icons A.cassette:before {
		background: url('/ui-artwork/cassette.png');
		background-size: 60px 60px;
	}

	file-icons A.power:before {
		background: url('/ui-artwork/power.png');
		background-size: 60px 60px;
	}
</style>

<script>
	// The following is requires for the webcomponents polyfill
    document._currentScript = document._currentScript || document.currentScript;
    
	// importDoc references this import's document
    var fileIconsImportDoc = document._currentScript.ownerDocument;
	
    var FileIconsProto = Object.create(HTMLElement.prototype);

	FileIconsProto.createdCallback = function() {
		var t = fileIconsImportDoc.getElementById('FileIconsTemplate');
      	var clone = document.importNode(t.content, true);
      	var shadowRoot = this.createShadowRoot();
		shadowRoot.appendChild(clone);

		this.update();
	};

	/* The following function wraps the contents of the "files-icons" tag
	 *
	 *  <file-icons>
	 *     <a>...</a>
	 *     <a>...</a>
	 *  </file-icons>
	 *
	 * Becomes:
	 *
	 *  <file-icons>
	 *    <ol>
	 *       <li><a>...</a></li>
	 *       <li><a>...</a></li>
	 *    </ol>
	 *  </file-icons>
	 *
	 * This is currently done in the host element rather than the shadow DOM
	 * because I could not figure out how to properly get it to work with nested
	 * shadow DOMs. Currently all the shadow DOM does is add a style sheet to
	 * convert the list into icons.
	 */
	FileIconsProto.update = function() {
		
		/* Sets the class for an icon. If the class is not defined, then the
		 * class becomes the data-type, else hyperlink if there is no data-type
		 */
		function setDefaultIconClass(e) {
			if(e.className == "") {
				if(e.getAttribute("data-type")) {
					$(e).addClass(e.getAttribute("data-type"))
				} else {
					$(e).addClass("hyperlink");
				}
			}
		}

		var list = $(this).find("UL");
		if(!list.size()) {
			list = document.createElement("UL");
			list.className = "icons";
			this.appendChild(list);
		} else {
			list = list[0];
		}

		var anchors = $(this).children("A");
		if(anchors.size()) {
			anchors.each(function(i,e) {
				setDefaultIconClass(e);
				var listItem = document.createElement("LI");
				listItem.appendChild(e);
				list.appendChild(listItem);
			});
		}
	}

	var FileIcons = document.registerElement('file-icons', {prototype: FileIconsProto});
</script>
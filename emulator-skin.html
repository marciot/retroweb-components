<!--
RetroWeb Browser
Copyright (C) 2014 Marcio Teixeira

This program is free software; you can redistribute it and/or
modify it under the terms of the GNU General Public License
as published by the Free Software Foundation; either version 2
of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
-->
<template id="EmulatorSkinTemplate">
	<style>
		/* Expand up to max-width, then center horizontally */
		.horizontalExpandAndCenter {
			position:				relative;
			padding:				0px;
			
			width:					100%;
			height:					100%;
			
			max-width:				1500px;

			margin-left:			auto;
			margin-right:			auto;
		}

		.no-select {
			-webkit-touch-callout:	none;
			-webkit-user-select:	none;
			-khtml-user-select:		none;
			-moz-user-select:		none;
			-ms-user-select:		none;
			user-select:			none;
		}

		.sidebar {
			position:				relative;
			height:					100%;
			margin:					0;
		}

		.screen-position-and-size {
			position:				absolute;
		}

		.background {
			/* Anchor to the top-right of the document */
			position:				absolute;
			top:					0px;
			right:					0px;

			background-repeat:		no-repeat;
			background-size:		100%;
		}
	</style>
	<style id="skin-resources">
		/* These styles will be replaced by EmulatorSkinProto.load */
		.background {
			display:				none;
		}
	</style>
	<div id="skin" class="horizontalExpandAndCenter no-select background-max-width">
		<div class="background">
			<div class="screen-position-and-size">
				<content select="#screen-area"></content>
			</div>
		</div>
		<div class="sidebar">
			<content select="#sidebar"></content>
		</div>
	</div>
</template>

<style>
	body, html {
		margin:		0;
		padding:	0;
		height:		100%;
		width:		100%;
	}
	
	emulator-skin {
		width: 100%;
	}
</style>

<script>
	var skinsPath	= "/components/skins";
	var skinLibrary = [
		"amiga500", "apple2e", "atari1040st",  "commodore64c", "ibm5160",
		"macplus",   "rc759",  "trs80-model1", "xerox-star"
	];

	// The following is requires for the webcomponents polyfill
	document._currentScript = document._currentScript || document.currentScript;

	// skinImportDoc references this import's document

    var skinImportDoc = document._currentScript.ownerDocument;

	var EmulatorSkinProto = Object.create(HTMLElement.prototype);

	EmulatorSkinProto.createdCallback = function() {
		var t = skinImportDoc.getElementById('EmulatorSkinTemplate');
		var clone = document.importNode(t.content, true);
		var shadowRoot = this.createShadowRoot();
		shadowRoot.appendChild(clone);

		// Load the skin resources
		var name = this.getAttribute('name');
		if(name) {
			this.loadByName(name);
		}

		var flush = this.getAttribute('flush');
		if(flush == "right") {
			$(shadowRoot).find("#skin").addClass("flush-right");
		}
	};

	EmulatorSkinProto.loadByName = function(name) {
		$(this.shadowRoot).find("#skin-resources").load(skinsPath + '/' + name + ".css", null,
			function(response, status, xhr) {
				if (status == "error") {
					alert("Unable to find the skins, please make sure the variable skinsPath is set correctly");
				}
			}
		);
	}

	EmulatorSkinProto.getNames = function() {
		return skinLibrary;
	}

	Object.defineProperty(EmulatorSkinProto, "name",  {writable: true});
	Object.defineProperty(EmulatorSkinProto, "flush", {writable: true});

	var EmulatorSkin = document.registerElement('emulator-skin', {prototype: EmulatorSkinProto});
</script>